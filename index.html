<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monad WalletConnect - GitHub Pages</title>
  <meta name="description" content="è¿æ¥åˆ° Monad ç½‘ç»œï¼Œå‘é€ MON ä»£å¸" />
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”—</text></svg>">

  <!-- WalletConnect v2 -->
  <script src="https://unpkg.com/@walletconnect/modal@2.6.2/dist/index.umd.js"></script>
  <script src="https://unpkg.com/@walletconnect/sign-client@2.10.2/dist/index.umd.js"></script>
  <script src="https://unpkg.com/viem@1.19.11/index.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      background: linear-gradient(135deg, #000 0%, #1a1a2e 100%);
      color: #fff; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      text-align: center; 
      padding: 20px; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .container {
      max-width: 600px;
      width: 100%;
      background: rgba(26, 26, 46, 0.8);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #f0b90b, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      margin-bottom: 30px;
      opacity: 0.8;
      font-size: 1.1em;
    }
    
    button { 
      padding: 15px 30px; 
      margin: 10px; 
      background: linear-gradient(45deg, #f0b90b, #ff6b6b);
      color: #000; 
      border: none; 
      border-radius: 12px; 
      font-size: 16px; 
      font-weight: 600;
      cursor: pointer; 
      transition: all 0.3s;
      min-width: 200px;
    }
    
    button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(240, 185, 11, 0.3);
    }
    
    button:disabled { 
      background: #666; 
      cursor: not-allowed; 
      transform: none;
      box-shadow: none;
    }
    
    .button-disconnect {
      background: linear-gradient(45deg, #ff4444, #cc0000) !important;
      color: white !important;
    }
    
    .button-network {
      background: linear-gradient(45deg, #007bff, #0056b3) !important;
      color: white !important;
    }
    
    input { 
      width: 100%; 
      padding: 15px; 
      border-radius: 8px; 
      border: 1px solid #444; 
      margin: 10px 0; 
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    input:focus {
      outline: none;
      border-color: #f0b90b;
      box-shadow: 0 0 0 2px rgba(240, 185, 11, 0.2);
    }
    
    input::placeholder {
      color: #888;
    }
    
    .status { 
      background: rgba(0,0,0,0.3); 
      padding: 15px; 
      border-radius: 12px; 
      margin: 20px 0; 
      border: 1px solid #333;
      word-break: break-all;
      transition: all 0.3s;
    }
    
    .error {
      background: rgba(255, 68, 68, 0.2) !important;
      border-color: #ff4444 !important;
      color: #ff8888 !important;
    }
    
    .success {
      background: rgba(0, 170, 0, 0.2) !important;
      border-color: #00aa00 !important;
      color: #88ff88 !important;
    }
    
    .loading {
      background: rgba(240, 185, 11, 0.2) !important;
      border-color: #f0b90b !important;
      color: #f0b90b !important;
    }
    
    a {
      color: #f0b90b;
      text-decoration: none;
      font-weight: 500;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .divider {
      margin: 30px 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #333, transparent);
    }
    
    .form-section {
      background: rgba(0,0,0,0.2);
      padding: 25px;
      border-radius: 15px;
      margin-top: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .form-title {
      font-size: 1.5em;
      margin-bottom: 20px;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    
    .github-link {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 50%;
      transition: all 0.3s;
    }
    
    .github-link:hover {
      background: rgba(240, 185, 11, 0.8);
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 20px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      button {
        min-width: auto;
        width: 100%;
        margin: 5px 0;
      }
      
      .button-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- GitHub é“¾æ¥ -->
  <a href="https://github.com" class="github-link" target="_blank">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
      <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
    </svg>
  </a>

  <div class="container">
    <h1>ğŸ”— Monad Connect</h1>
    <p class="subtitle">æ‰«ç è¿æ¥ä»»æ„ Web3 é’±åŒ…ï¼Œè‡ªåŠ¨æ·»åŠ  Monad ç½‘ç»œ</p>

    <div class="button-group">
      <button id="connectBtn">ğŸ“± æ‰«ç è¿æ¥é’±åŒ…</button>
      <button id="disconnectBtn" class="button-disconnect" style="display:none;">æ–­å¼€è¿æ¥</button>
    </div>

    <div class="status" id="status">ğŸ”´ æœªè¿æ¥</div>

    <div class="divider"></div>

    <div class="form-section">
      <h3 class="form-title">ğŸ’¸ å‘é€ MON ä»£å¸</h3>
      
      <input id="toAddress" placeholder="æ¥æ”¶åœ°å€ 0x..." />
      <input id="amount" placeholder="æ•°é‡ï¼Œå¦‚ 0.01" type="number" step="0.000001" />
      
      <div class="button-group">
        <button id="sendBtn" disabled>å‘é€ MON</button>
        <button id="addNetworkBtn" class="button-network" disabled>æ·»åŠ  Monad ç½‘ç»œ</button>
      </div>
    </div>

    <div class="status" id="txHash"></div>
    <div class="status error" id="errorMsg" style="display:none;"></div>
  </div>

<script type="module">
  // ===========================
  // é…ç½®åŒºåŸŸ - GitHub Pages é€‚é…
  // ===========================
  // å…è´¹ Project ID - è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„
  // è·å–åœ°å€: https://cloud.walletconnect.com/
  const projectId = "512414a568dd1ac5074a89997f7870b7"; 
  
  const monadChainId = 143;
  const monadChainIdHex = "0x8f";
  const monadRpc = "https://rpc.monad.xyz";

  const monadChain = {
    chainId: monadChainIdHex,
    chainName: "Monad",
    rpcUrls: [monadRpc],
    nativeCurrency: { 
      name: "MON", 
      symbol: "MON", 
      decimals: 18 
    },
    blockExplorerUrls: ["https://explorer.monad.xyz"],
  };

  // ===========================
  // å…¨å±€å˜é‡
  // ===========================
  let signClient = null;
  let wcModal = null;
  let session = null;
  let account = null;

  const status = document.getElementById("status");
  const connectBtn = document.getElementById("connectBtn");
  const disconnectBtn = document.getElementById("disconnectBtn");
  const sendBtn = document.getElementById("sendBtn");
  const addNetworkBtn = document.getElementById("addNetworkBtn");
  const errorMsg = document.getElementById("errorMsg");

  // ===========================
  // å·¥å…·å‡½æ•°
  // ===========================
  function showStatus(message, type = 'normal') {
    status.className = `status ${type}`;
    status.innerHTML = message;
  }

  function showError(message) {
    errorMsg.style.display = 'block';
    errorMsg.className = 'status error';
    errorMsg.innerHTML = `âŒ ${message}`;
    setTimeout(() => {
      errorMsg.style.display = 'none';
    }, 8000);
  }

  function isValidAddress(address) {
    return /^0x[a-fA-F0-9]{40}$/.test(address);
  }

  // ===========================
  // åˆå§‹åŒ– WalletConnect
  // ===========================
  async function initWC() {
    try {
      showStatus("ğŸ”„ åˆå§‹åŒ–ä¸­...", "loading");
      
      // æ£€æŸ¥æ˜¯å¦åœ¨ HTTPS ç¯å¢ƒ
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        showError('è¯·ä½¿ç”¨ HTTPS è®¿é—®æ­¤åº”ç”¨');
        return;
      }
      
      signClient = await window.WalletConnect.SignClient.init({
        projectId,
        metadata: {
          name: "Monad Connect",
          description: "è¿æ¥åˆ° Monad ç½‘ç»œè¿›è¡Œ MON ä»£å¸è½¬è´¦",
          url: window.location.origin,
          icons: ["https://avatars.githubusercontent.com/u/37784886"],
        },
      });

      wcModal = new window.WalletConnect.WalletConnectModal({
        projectId,
        chains: [`eip155:${monadChainId}`],
      });

      // æ£€æŸ¥ç°æœ‰ä¼šè¯
      if (signClient.session.length) {
        const lastSession = signClient.session[signClient.session.length - 1];
        onSessionConnected(lastSession);
      } else {
        showStatus("ğŸ”´ æœªè¿æ¥");
      }

      console.log('âœ… WalletConnect åˆå§‹åŒ–æˆåŠŸ');
      
    } catch (error) {
      console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
      showError(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
    }
  }

  // ===========================
  // ä¼šè¯è¿æ¥å¤„ç†
  // ===========================
  function onSessionConnected(sessionData) {
    session = sessionData;
    const accounts = session.namespaces?.eip155?.accounts || [];
    
    if (accounts.length > 0) {
      account = accounts[0].split(":")[2];
      showStatus(`ğŸŸ¢ å·²è¿æ¥: ${account.slice(0, 6)}...${account.slice(-4)}`, "success");
      
      connectBtn.style.display = 'none';
      disconnectBtn.style.display = 'inline-block';
      sendBtn.disabled = false;
      addNetworkBtn.disabled = false;
      
      console.log('âœ… é’±åŒ…è¿æ¥æˆåŠŸ:', account);
    }
  }

  // ===========================
  // è¿æ¥é’±åŒ…
  // ===========================
  async function connectWallet() {
    try {
      if (!signClient) {
        await initWC();
        if (!signClient) return;
      }

      showStatus("ğŸ”„ æ­£åœ¨è¿æ¥...", "loading");
      connectBtn.disabled = true;

      const { uri, approval } = await signClient.connect({
        requiredNamespaces: {
          eip155: {
            chains: [`eip155:${monadChainId}`],
            methods: [
              "eth_sendTransaction",
              "eth_accounts",
              "eth_requestAccounts", 
              "personal_sign",
              "eth_signTypedData",
              "wallet_addEthereumChain",
              "wallet_switchEthereumChain"
            ],
            events: ["accountsChanged", "chainChanged"],
          },
        },
      });

      if (uri) {
        wcModal.openModal({ uri });
        showStatus("ğŸ“± è¯·åœ¨é’±åŒ…ä¸­æ‰«æäºŒç»´ç ", "loading");
      }

      const sessionData = await approval();
      wcModal.closeModal();
      
      onSessionConnected(sessionData);
      
    } catch (error) {
      console.error('âŒ è¿æ¥å¤±è´¥:', error);
      showError(`è¿æ¥å¤±è´¥: ${error.message}`);
      wcModal?.closeModal();
    } finally {
      connectBtn.disabled = false;
    }
  }

  // ===========================
  // æ–­å¼€è¿æ¥
  // ===========================
  async function disconnectWallet() {
    try {
      if (session && signClient) {
        await signClient.disconnect({
          topic: session.topic,
          reason: {
            code: 6000,
            message: "ç”¨æˆ·æ–­å¼€è¿æ¥"
          }
        });
      }
      
      session = null;
      account = null;
      
      showStatus("ğŸ”´ å·²æ–­å¼€è¿æ¥");
      connectBtn.style.display = 'inline-block';
      disconnectBtn.style.display = 'none';
      sendBtn.disabled = true;
      addNetworkBtn.disabled = true;
      
      // æ¸…ç©ºè¡¨å•
      document.getElementById("toAddress").value = "";
      document.getElementById("amount").value = "";
      document.getElementById("txHash").innerHTML = "";
      
    } catch (error) {
      console.error('âŒ æ–­å¼€è¿æ¥å¤±è´¥:', error);
      showError(`æ–­å¼€è¿æ¥å¤±è´¥: ${error.message}`);
    }
  }

  // ===========================
  // æ·»åŠ  Monad ç½‘ç»œ
  // ===========================
  async function addMonadNetwork() {
    try {
      if (!session) {
        showError("è¯·å…ˆè¿æ¥é’±åŒ…");
        return;
      }

      showStatus("ğŸ”„ æ­£åœ¨æ·»åŠ  Monad ç½‘ç»œ...", "loading");
      addNetworkBtn.disabled = true;

      await signClient.request({
        topic: session.topic,
        chainId: `eip155:${monadChainId}`,
        request: {
          method: "wallet_addEthereumChain",
          params: [monadChain],
        },
      });

      showStatus(`ğŸŸ¢ å·²è¿æ¥: ${account.slice(0, 6)}...${account.slice(-4)}`, "success");
      
      // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      const successMsg = document.createElement('div');
      successMsg.className = 'status success';
      successMsg.innerHTML = 'âœ… Monad ç½‘ç»œæ·»åŠ æˆåŠŸï¼';
      addNetworkBtn.parentNode.appendChild(successMsg);
      
      setTimeout(() => {
        successMsg.remove();
      }, 3000);
      
    } catch (error) {
      console.error('âŒ æ·»åŠ ç½‘ç»œå¤±è´¥:', error);
      
      if (error.message.includes("already exists") || 
          error.message.includes("User rejected") ||
          error.code === 4001) {
        showStatus(`ğŸŸ¢ å·²è¿æ¥: ${account.slice(0, 6)}...${account.slice(-4)}`, "success");
        
        const infoMsg = document.createElement('div');
        infoMsg.className = 'status';
        infoMsg.innerHTML = 'â„¹ï¸ Monad ç½‘ç»œå·²å­˜åœ¨æˆ–ç”¨æˆ·å–æ¶ˆ';
        addNetworkBtn.parentNode.appendChild(infoMsg);
        
        setTimeout(() => {
          infoMsg.remove();
        }, 3000);
      } else {
        showError(`æ·»åŠ ç½‘ç»œå¤±è´¥: ${error.message}`);
      }
    } finally {
      addNetworkBtn.disabled = false;
    }
  }

  // ===========================
  // å‘é€äº¤æ˜“
  // ===========================
  async function sendTransaction() {
    try {
      const to = document.getElementById("toAddress").value.trim();
      const amount = document.getElementById("amount").value.trim();

      // è¾“å…¥éªŒè¯
      if (!to) {
        showError("è¯·è¾“å…¥æ¥æ”¶åœ°å€");
        return;
      }

      if (!isValidAddress(to)) {
        showError("æ¥æ”¶åœ°å€æ ¼å¼ä¸æ­£ç¡®");
        return;
      }

      if (!amount || isNaN(amount) || Number(amount) <= 0) {
        showError("è¯·è¾“å…¥æ­£ç¡®çš„è½¬è´¦é‡‘é¢");
        return;
      }

      if (!session || !account) {
        showError("è¯·å…ˆè¿æ¥é’±åŒ…");
        return;
      }

      showStatus("ğŸ”„ æ­£åœ¨å‘é€äº¤æ˜“...", "loading");
      sendBtn.disabled = true;

      // è½¬æ¢é‡‘é¢ä¸º wei
      const amountWei = BigInt(Math.floor(Number(amount) * Math.pow(10, 18)));
      const valueHex = "0x" + amountWei.toString(16);

      const transaction = {
        from: account,
        to: to,
        value: valueHex,
        data: "0x",
        gas: "0x5208", // 21000 gas for simple transfer
      };

      const txHash = await signClient.request({
        topic: session.topic,
        chainId: `eip155:${monadChainId}`,
        request: {
          method: "eth_sendTransaction",
          params: [transaction],
        },
      });

      showStatus(`ğŸŸ¢ å·²è¿æ¥: ${account.slice(0, 6)}...${account.slice(-4)}`, "success");
      
      document.getElementById("txHash").innerHTML = `
        <div style="color: #88ff88; padding: 20px; background: rgba(0,170,0,0.1); border-radius: 15px; border: 1px solid #00aa00;">
          <div style="font-size: 1.2em; margin-bottom: 15px;">
            âœ… äº¤æ˜“å‘é€æˆåŠŸï¼
          </div>
          
          <div style="margin-bottom: 10px;">
            <strong>ğŸ’° é‡‘é¢:</strong> ${amount} MON
          </div>
          
          <div style="margin-bottom: 10px;">
            <strong>ğŸ“ æ¥æ”¶åœ°å€:</strong><br>
            ${to}
          </div>
          
          <div style="margin-bottom: 15px;">
            <strong>ğŸ”— äº¤æ˜“å“ˆå¸Œ:</strong><br>
            <span style="font-family: monospace; font-size: 0.9em; word-break: break-all;">
              ${txHash}
            </span>
          </div>
          
          <a href="https://explorer.monad.xyz/tx/${txHash}" target="_blank" 
             style="display: inline-block; padding: 10px 20px; background: #f0b90b; color: #000; border-radius: 8px; text-decoration: none; font-weight: 600;">
            ğŸ” åœ¨åŒºå—é“¾æµè§ˆå™¨ä¸­æŸ¥çœ‹
          </a>
        </div>
      `;

      // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById("toAddress").value = "";
      document.getElementById("amount").value = "";

    } catch (error) {
      console.error('âŒ å‘é€äº¤æ˜“å¤±è´¥:', error);
      showStatus(`ğŸŸ¢ å·²è¿æ¥: ${account.slice(0, 6)}...${account.slice(-4)}`, "success");
      showError(`å‘é€äº¤æ˜“å¤±è´¥: ${error.message}`);
    } finally {
      sendBtn.disabled = false;
    }
  }

  // ===========================
  // äº‹ä»¶ç›‘å¬
  // ===========================
  connectBtn.addEventListener('click', connectWallet);
  disconnectBtn.addEventListener('click', disconnectWallet);
  sendBtn.addEventListener('click', sendTransaction);
  addNetworkBtn.addEventListener('click', addMonadNetwork);

  // Enter é”®æ”¯æŒ
  document.getElementById('amount').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !sendBtn.disabled) {
      sendTransaction();
    }
  });

  // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
  window.addEventListener('load', () => {
    console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
    setTimeout(initWC, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿åº“åŠ è½½å®Œæˆ
  });

  // é¡µé¢å¸è½½æ—¶æ¸…ç†
  window.addEventListener('beforeunload', () => {
    if (session && signClient) {
      signClient.disconnect({
        topic: session.topic,
        reason: { code: 6000, message: "é¡µé¢å…³é—­" }
      });
    }
  });

</script>

</body>
</html>